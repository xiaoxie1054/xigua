/*********************************************************************************
플러그인 : jquery.DB_gallery.js
제작자 : Copyright ⓒ 2012 by 디자인블랙(http://designblack.com) 
라이센스 : 도메인라이센스
기타 : 본 플러그인 파일의 정보(주석)는 삭제할 수 없습니다.
       홈페이지를 통해 이용도메인을 승인 받아야 합니다.
*********************************************************************************/
;(function($){
$.fn.DB_gallery=function(options){
	var opt={
		thumWidth:110,              //썸네일가로
		thumGap:8,                  //썸네일간격
		thumMoveStep:5,             //썸네일이동갯수
		moveSpeed:200,              //이동속도
		fadeSpeed:300,              //화면전환속도
		end:''
	}
	$.extend(opt,options);
	return this.each(function(){
		var $this=$(this);
		var $imgSet=$this.find('.DB_imgSet');
		var $imgWin=$imgSet.find('.DB_imgWin');
		var $page=$this.find('.DB_page');
		var $pageCurrent=$page.find('.DB_current');
		var $pageTotal=$page.find('.DB_total');
		var $thumSet=$this.find('.DB_thumSet');
		var $thumMove=$thumSet.find('.DB_thumMove');
		var $thumList=$thumMove.find('li');
		var $thumLine=$this.find('.DB_thumLine');
		var $nextBtn=$this.find('.DB_nextBtn');
		var $prevBtn=$this.find('.DB_prevBtn');
		var $nextPageBtn=$this.find('.DB_nextPageBtn');
		var $prevPageBtn=$this.find('.DB_prevPageBtn');
		var objNum=$thumList.length;
		var currentObj=0;
		var fixObj=0;
		var currentPage=0;
		var totalPage=Math.floor(objNum/opt.thumMoveStep);
		var oldImg;

		init();

		function init(){
			setInit();
			setMouseEvent();
			changeImg();
		}
         
		function setInit(){
			//썸네일 라인 위치변경
			$thumMove.append($thumLine.get());
			
		}

		//바인딩
		function setMouseEvent(){
			$thumList.bind('click',function(e){
				e.preventDefault();
				currentObj=$(this).index();
				changeImg();
			});
			$nextBtn.bind('click',function(){
				currentObj++;
				if(currentObj==objNum){currentObj=0;}
				changeImg();
				currentPage=Math.floor(currentObj/opt.thumMoveStep);
				moveThum();

			});
			$prevBtn.bind('click',function(){
				currentObj--;
				if(currentObj==-1){currentObj=objNum-1;}
				changeImg();
				currentPage=Math.floor(currentObj/opt.thumMoveStep);
				moveThum();
			});
			$nextPageBtn.bind('click',function(){
				currentPage++;
				moveThum();
			});
			$prevPageBtn.bind('click',function(){
				currentPage--;
				moveThum();
			});
		
		}
		
		//썸네일 이동
		function moveThum(){
			var pos=((opt.thumWidth+opt.thumGap)*opt.thumMoveStep)*currentPage
			$thumMove.animate({'left':-pos},opt.moveSpeed);
			//
			setVisibleBtn();
		}

		//이미지변경에 따른 버튼처리
		function setVisibleBtn(){
			$prevBtn.hide();$nextBtn.hide(); 
			$(".DB_imgSet img").hover(function(){
			$prevBtn.show();$nextBtn.show();
			},function(){
			$prevBtn.hide();$nextBtn.hide();                       
			});
			$prevBtn.click(function() {
			$prevBtn.show();
			});
			$nextBtn.click(function() {
			$nextBtn.show();
			});
			$prevPageBtn.show();
			$nextPageBtn.show();
			
			
			if(currentPage==0)$prevPageBtn.hide();
			if(currentPage==totalPage-1)$nextPageBtn.hide();
			/*if(currentObj==0)$prevBtn.hide();
			if(currentObj==objNum-1)$nextBtn.hide();*/
		}

		//이미지변경
		function changeImg(){
			if(oldImg!=null){
				//부드러운 전환을 위해 배경에 기존이미지를 배치
				$imgWin.css('background','url('+oldImg+') no-repeat');
			}
			//클릭이미지
			var $thum=$thumList.eq(currentObj)
			var _src=oldImg=$thum.find('a').attr('href');
			$imgWin.find('img').hide().attr('src',_src).fadeIn(opt.fadeSpeed);
			oldImg=_src

			//썸네일라인 위치변경
			$thumLine.css({'left':$thum.position().left})

			//페이지변경
			$pageCurrent.text(currentObj+1);
			$pageTotal.text(objNum);
			
			setVisibleBtn();
		}
	})
}
})(jQuery)
$(document).ready(function(){
/*var DB_thumLine=$('.DB_thumSet .DB_thumLine1').clone();
$(".DB_thumMove img").mouseover(function(){
  $(this).after(DB_thumLine);
  });
$('.DB_thumMove img').mouseout(function(){
              
});*/
});