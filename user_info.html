<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>添加学生信息</title>

</head>

<body>
<?php
	include_once("include.php");
	
	if(!empty($_REQUEST['id'])){/*if(isset($_REQUEST['id'])),然后就没有action，和下面的隐藏域*/
		$user=new User($db,'tb_user_reg');
		$user_info=$user->get_user_byid($_REQUEST['id']);
			
		if(isset($_REQUEST['update'])){
			$user_name=trim($_REQUEST['user_name']);
			$user_password=trim($_REQUEST['user_password']);
			$user_email=trim($_REQUEST['user_email']);
			$user_time=$user_info['user_time'];
			$data=array('user_name'=>$user_name,'user_password'=>$user_password,'user_email'=>$user_email,'user_time'=>$user_time);
			if($user->update_user_byid($_REQUEST['id'],$data)){
				$cur_page=$_GET['p'];
				$address='user_list.php?p='.$cur_page;
				$db->success_txt($address);	
			}else{
				$cur_page=$_GET['p'];
				$address='user_info.php?p='.$cur_page;
				$db->fail_txt($address);
			}
		}
	}
?>
<form action="user_info.php?p=<?php echo $_GET['p']?>" method="post">      
	<table width="500" height="200" cellspacing="0" border="0" align="center">
		<tr>
        	<th colspan="2"><big><?php echo !empty($user_info)?"修改用户信息":"添加用户信息"?></big></th>
        </tr>
        <tr>
        	<td align="right">用户名：</td>
            <td align="left"><input name="user_name" type="text" value="<?php echo !empty($user_info)?$user_info['user_name']:'';?>" /></td>
        </tr>
        <tr>
        	<td align="right">用户密码：</td>
            <td align="left"><input name="user_password" type="text" value="<?php echo !empty($user_info)?$user_info['user_password']:'';?>" /></td>
        </tr>
        <tr>
        	<td align="right">用户邮箱：</td>
            <td align="left"><input name="user_email" type="text" value="<?php echo !empty($user_info)?$user_info['user_email']:'';?>" /></td>
        </tr>
        <tr>
        	<?php 
				if(!empty($user_info)){
			?>
            	<td colspan="2" align="center"><input type="submit" name="update" value="修改"/></td>		
				<?php 
				}else{
				?>
                <td colspan="2" align="center"><input type="submit" name="insert" value="添加"/></td>
                <?php
                }
				?>
        </tr>
	</table>
    <?php 
		if(isset($_REQUEST['insert'])){
			$user=new User($db,'tb_user_reg');
			$user_name=trim($_REQUEST['user_name']);
			$user_password=trim($_REQUEST['user_password']);
			$user_email=trim($_REQUEST['user_email']);
			if($user->insert_user($user_name,$user_password,$user_email)){
				$page_size=5;
				$page_se=new Page_se($db,'tb_user_reg','user_id',$page_size); //获取总的页数，才能跳转到最后一页
				$page_nums=$page_se->select_page_nums();
				/*$cur_page=$_GET['p'];*/
				$address='user_list.php?p='.$page_nums;
				$db->success_txt($address);	
			}else{
				$cur_page=$_GET['p'];
				$address='user_info.php?p='.$cur_page;   //否者跳转到当前页
				$db->fail_txt($address);
			}
		}
	?>
    <input type="hidden" name="id" value="<?php echo !empty($user_info) ? $user_info['user_id'] : '' ?>"/>
</form>
</body>
</html>